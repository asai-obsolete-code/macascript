
(defun value (arg)
  (list 'value arg))

(defmacro value-if (need-value arg)
  `(if ,need-value
	   (list 'value ,arg)
	   ,arg))


;; --------------------------------
;; fundamentals

;; these operators are just meant to be used by the compiler
;; don't use it
(defparameter *fundamentals*
  '(;;((list 'glue 'nil 'semicolon 'newline) (rewrite m-glue nil))
	((list* 'glue clauses)              (rewrite m-glue clauses))
	((list 'paren (list 'paren clause)) (rewrite m-redundant-paren clause))
	((list 'paren clause)               (rewrite m-paren clause))
	((list 'bracket clause)             (rewrite m-bracket clause))
	((list* 'comma clauses)             (rewrite m-comma clauses))
	((list 'blk clause)                 (rewrite m-block clause))
	((list 'value arg)                  (rewrite m-need-value arg))
	((list '// str)                     (rewrite m-comment str))
	((list 'raw-string str)             (rewrite m-raw-string str))))

(defun m-glue (s env need-value args)
  (declare (ignore need-value))
  (format s "狺磲疸狎＇灬礅溽ㄡ蜱戾è趄蹂狎矧ㄣ潋ㄡ篌镢狎犰獒箦螵┅狎绌┅豉疱汜箦趄蹂狎铛祆ㄣ镱憝泔眇殪铋孱铋趄蹂狎绌换ㄡ麸憝泔眇殪铋孱趄蹂狎绌篝蜷铉ㄦ矧磲铋④彳趄蹂狎绌簌礅镬戾è篝簌礅镬钺礤趄蹂狎绌┅ㄣ镱è汨狎ㄡ蝈篝癌＼扩憝泔眇殪铋孱铋趄蹂狎绌è弼弪＇灬礅溽ㄣ矧铒ㄢ雉璀汜箦悌躔疱颦汜箦悌┅篝颟篝蜷铉滹黝汜箦篝颟篝颟┅ㄦ矧磲铋幄趄蹂狎绌┅┅狎珞┅ㄤ彐磲汜憝疳蝈ㄡ蜱啜珈蹂祓狎孱狎蝠狎孱┅ㄤ彐躅憝蝈漉钿犷舡疳蝈孱铄邃鲠祯狎绌ㄤ邈灬蝈ㄩ珙矧铄邃鲠祯濠憝泔眇殪孱铋啜疳蝈狎绌┅ㄤ彐磲汜憝怛徙脲ㄡ蜱啜珈蹂焘蜥汶弭狎蜮蜥汶弭┅ㄤ彐磲汜憝忪镢ㄡ蜱啜珈蹂焘蜥沐铄黛轭狎蜮蜥沐┅ㄤ彐磲汜憝泔眄ㄡ蜱螬啜珈蹂括磲疸犷＇灬礅溽ㄡ蜱扉篝狎с镯磲┅ㄢ豸灬篝狎珞┅ㄩ铄邃鲠祯啜鲠祯括灬篝狎珞┅ㄣ狎灬篝狎珞┅┅ㄤ彐躅憝泔眄孱孱铄邃鲠祯篝蜷铉ㄤ邈灬蝈ㄩ珙矧铄邃鲠祯濠ㄤ邈灬蝈ㄩ珙矧孱雯ㄦ矧磲ア篝蜷铉┅ㄤ彐躅憝蜥鳝篝蜷铉孱铄邃鲠祯篝蜷铉ㄤ邈灬蝈ㄩ珙矧铄邃鲠祯濠ㄤ邈灬蝈ㄩ珙矧孱螬篝蜷铉ㄤ彐磲汜憝铄邃鲠祯ㄡ蜱箦翩铄舡铄邃鲠祯舂狎绌